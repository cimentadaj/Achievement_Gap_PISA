)
mod_tracking
bayes_R2(mod_tracking)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ num_tracks + zvoc,
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
bayes_R2(mod_tracking)
ready_data_two
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ num_tracks + I(age_selection >= 15, 1, 0),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ num_tracks + I(age_selection >= 15),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
bayes_R2(mod_tracking)
pp_check(mod_tracking, type = "dens_overlay", nsamples = 100)
pp_check(mod_tracking, type = "boxplot", nsamples = 30)
pp_check(mod_tracking, type = "error_scatter_avg", nsamples = 1000)
30 / 2
34 / 2
34 / 3
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ num_tracks + I(age_selection >= 15) + zvoc,
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
bayes_R2(mod_tracking)
pp_check(mod_tracking, type = "dens_overlay", nsamples = 100)
pp_check(mod_tracking, type = "ecdf_overlay", nsamples = 10)
ready_data_two %>%
ggplot(aes(cum_diff, num_tracks)) +
geom_point()
ready_data_two %>%
ggplot(aes(cum_diff, num_tracks)) +
geom_point() +
geom_jitter()
ready_data_two %>%
ggplot(aes(cum_diff, num_tracks)) +
geom_point() +
geom_jitter() + geom_smooth()
ready_data_two %>%
ggplot(aes(cum_diff, num_tracks)) +
geom_point() +
geom_jitter()
ready_data_two %>%
ggplot(aes(cum_diff, num_tracks)) +
geom_point()
ready_data_two %>%
ggplot(aes(cum_diff, num_tracks)) +
geom_point() + facet_wrap(age_selection)
ready_data_two %>%
ggplot(aes(cum_diff, num_tracks)) +
geom_point() + facet_wrap(~ age_selection)
ready_data_two %>%
ggplot(aes(cum_diff, num_tracks)) +
geom_point() + facet_wrap(~ age_selection >= 15)
ready_data_two %>%
ggplot(aes(cum_diff, age_selection >= 15)) + geom_point()
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
bayes_R2(mod_tracking)
pp_check(mod_tracking, type = "dens_overlay", nsamples = 100)
pp_check(mod_tracking, type = "ecdf_overlay", nsamples = 10)
pp_check(mod_tracking, type = "boxplot", nsamples = 30)
pp_check(mod_tracking, type = "stat", nsamples = 200) # very nice to compare central tendency
pp_check(mod_tracking, type = "error_scatter_avg", nsamples = 1000)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("normal(0, 1)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
bayes_R2(mod_tracking)
pp_check(mod_tracking, type = "dens_overlay", nsamples = 100)
pp_check(mod_tracking, type = "ecdf_overlay", nsamples = 10)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("normal(0.5, 0.5)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
bayes_R2(mod_tracking)
?brms::prior
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("normal(1, 2)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
bayes_R2(mod_tracking)
pp_check(mod_tracking, type = "dens_overlay", nsamples = 100)
pp_check(mod_tracking, type = "ecdf_overlay", nsamples = 10)
pp_check(mod_tracking, type = "boxplot", nsamples = 30)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("normal(1, 2)"),
family = bernoulli("identity"),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
?stan_glmer
compare_priors <- function(scale = 1, df_t = 2, xlim = c(-10, 10)) {
dt_loc_scale <- function(x, df, location, scale) {
1/scale * dt((x - location)/scale, df)
}
dlaplace <- function(x, location, scale) {
0.5 / scale * exp(-abs(x - location) / scale)
}
dproduct_normal <- function(x, scale) {
besselK(abs(x) / scale ^ 2, nu = 0) / (scale ^ 2 * pi)
}
stat_dist <- function(dist, ...) {
ggplot2::stat_function(ggplot2::aes_(color = dist), ...)
}
ggplot2::ggplot(data.frame(x = xlim), ggplot2::aes(x)) +
stat_dist("normal", size = .75, fun = dnorm,
args = list(mean = 0, sd = scale)) +
stat_dist("student_t", size = .75, fun = dt_loc_scale,
args = list(df = df_t, location = 0, scale = scale)) +
stat_dist("cauchy", size = .75, linetype = 2, fun = dcauchy,
args = list(location = 0, scale = scale)) +
stat_dist("laplace", size = .75, linetype = 2, fun = dlaplace,
args = list(location = 0, scale = scale)) +
stat_dist("product_normal", size = .75, linetype = 2, fun = dproduct_normal,
args = list(scale = 1))
}
compare_priors()
compare_priors(scale = 5, xlim = c(-20,20))
compare_priors(scale = 1000, xlim = c(-1000,1000))
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("product_normal(3, 1, 2)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("product_normal(3, 0, 1)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("product_normal(5, 0, 1)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
?brms::prior
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("gamma(0, 1)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("gamma(2, 0.1)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
?gamma
gamma(10)
gamma(1:10)
gamma(10:1)
hist(gamma(10:1))
hist(gamma(100:1))
dens(gamma(100:1))
density(gamma(100:1))
plot(gamma(100:1))
gamma(100:1)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("inv_gamma(2, 0.1)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
bayes_R2(mod_tracking)
pp_check(mod_tracking, type = "dens_overlay", nsamples = 100)
pp_check(mod_tracking, type = "ecdf_overlay", nsamples = 10)
pp_check(mod_tracking, type = "boxplot", nsamples = 30)
y_rep <- posterior_predict(mod_tracking)
replication <-
map(1:2000, ~ {
ready_data_two %>%
mutate(pred_sample = y_rep[sample(1:4000, 1), , drop = TRUE]) %>%
summarize(perc_sample = mean(pred_sample > cum_diff),
minus_sample = mean(pred_sample - cum_diff))
})
y_pred_data <-
replication %>%
enframe() %>%
unnest()
y_pred_data %>% qplot(perc_sample, data = ., geom = "histogram", bins = 50)
y_pred_data %>% {quantile(.$perc_sample)}
y_pred_data %>%
summarize(mean_perc = mean(perc_sample < 0.5))
ready_data_two %>%
filter(!is.na(age_selection)) %>%
mutate(pred_median = posterior_predict(mod_tracking) %>% colMedians()) %>%
select(country, cum_diff, pred_median) %>%
gather(cat, value, -country) %>%
ggplot(aes(country, value, fill = cat)) +
geom_col(position = "dodge") +
coord_flip()
ready_data_two %>%
filter(!is.na(age_selection)) %>%
mutate(pred_median = posterior_predict(mod_tracking) %>% colMedians()) %>%
select(country, cum_diff, pred_median)
ready_data_two %>%
filter(!is.na(age_selection)) %>%
mutate(pred_median = posterior_predict(mod_tracking) %>% colMedians(),
ratio_pred = pred_median/cum_diff) %>%
select(country, ratio_pred, cum_diff, pred_median)
ready_data_two %>%
filter(!is.na(age_selection)) %>%
mutate(pred_median = posterior_predict(mod_tracking) %>% colMedians(),
ratio_pred = pred_median/cum_diff) %>%
select(country, ratio_pred, cum_diff, pred_median) %>%
ggplot(aes(ratio_pred)) +
geom_histogram()
ready_data_two %>%
filter(!is.na(age_selection)) %>%
mutate(pred_median = posterior_predict(mod_tracking) %>% colMedians(),
ratio_pred = pred_median/cum_diff) %>%
select(country, ratio_pred, cum_diff, pred_median) %>%
ggplot(aes(ratio_pred)) +
geom_histogram(bins = 50)
ready_data_two %>%
filter(!is.na(age_selection)) %>%
mutate(pred_median = posterior_predict(mod_tracking) %>% colMeans(),
ratio_pred = pred_median/cum_diff) %>%
select(country, ratio_pred, cum_diff, pred_median) %>%
ggplot(aes(ratio_pred)) +
geom_histogram(bins = 50)
ready_data_two %>%
filter(!is.na(age_selection)) %>%
mutate(pred_median = posterior_predict(mod_tracking) %>% colMeans(),
ratio_pred = pred_median/cum_diff) %>%
select(country, ratio_pred, cum_diff, pred_median)
m_data <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
mutate(pred_median = posterior_predict(mod_tracking) %>% colMeans(),
ratio_pred = pred_median/cum_diff) %>%
select(country, ratio_pred, cum_diff, pred_median)
m_data %>%
ggplot(aes(ratio_pred)) +
geom_histogram(bins = 50)
m_data %>%
filter(ratio_pred < 1)
m_data %>%
filter(!ratio_pred > 1)
m_data %>%
filter(ratio_pred < 1)
m_data %>%
filter(ratio_pred > 1)
m_data %>%
filter(ratio_pred > 1)
m_data %>%
filter(ratio_pred < 1)
m_data %>%
filter(ratio_pred < 1) %>%
ggplot(aes(country, ratio_pred)) +
geom_col()
m_data %>%
filter(ratio_pred < 1) %>%
ggplot(aes(country, ratio_pred)) +
geom_col() +
coord_flip()
m_data %>%
filter(ratio_pred < 1) %>%
ggplot(aes(reorder(country, -ratio_pred), ratio_pred)) +
geom_col() +
coord_flip()
m_data %>%
filter(ratio_pred < 1) %>%
ggplot(aes(reorder(country, -ratio_pred), 1 - ratio_pred)) +
geom_col() +
coord_flip()
m_data %>%
filter(ratio_pred < 1) %>%
ggplot(aes(reorder(country, -ratio_pred), 1 - ratio_pred)) +
geom_col() +
scale_y_continuous(breaks = seq(0, 0.3, 0.05)) +
coord_flip()
m_data %>%
filter(ratio_pred < 1) %>%
ggplot(aes(reorder(country, -ratio_pred), 1 - ratio_pred)) +
geom_col() +
scale_y_continuous(breaks = seq(0, 0.35, 0.05)) +
coord_flip()
m_data %>%
filter(ratio_pred < 1) %>%
ggplot(aes(reorder(country, -ratio_pred), 1 - ratio_pred)) +
geom_col() +
scale_y_continuous(breaks = seq(0, 0.30, 0.05), limits = c(0, 0.35)) +
coord_flip()
m_data %>%
filter(ratio_pred < 1) %>%
ggplot(aes(reorder(country, -ratio_pred), 1 - ratio_pred)) +
geom_col() +
scale_y_continuous(breaks = seq(0, 0.30, 0.05), limits = c(0, 0.3)) +
coord_flip()
m_data <-
ready_data_two %>%
filter(!is.na(age_selection), country %in% countries) %>%
mutate(pred_median = posterior_predict(mod_tracking) %>% colMeans(),
ratio_pred = pred_median/cum_diff) %>%
select(country, ratio_pred, cum_diff, pred_median)
m_data <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
mutate(pred_median = posterior_predict(mod_tracking) %>% colMeans(),
ratio_pred = pred_median/cum_diff) %>%
select(country, ratio_pred, cum_diff, pred_median)
m_data <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
mutate(pred_median = posterior_predict(mod_tracking) %>% colMeans(),
ratio_pred = pred_median/cum_diff) %>%
select(country, ratio_pred, cum_diff, pred_median)
m_data %>%
ggplot(aes(reorder(country, -ratio_pred), 1 - ratio_pred)) +
geom_col() +
scale_y_continuous(breaks = seq(0, 0.30, 0.05), limits = c(0, 0.3)) +
coord_flip()
m_data
m_data %>% mutate(r = ratio_pred - 1)
m_data %>%
ggplot(aes(reorder(country, -ratio_pred), 1 - ratio_pred)) +
geom_col() +
scale_y_continuous(breaks = seq(-0.30, 0.30, 0.05), limits = c(-0.3, 0.3)) +
coord_flip()
m_data %>%
ggplot(aes(reorder(country, -ratio_pred), 1 - ratio_pred)) +
geom_col() +
scale_y_continuous(breaks = seq(-0.3, 0.3, 0.5), limits = c(-0.3, 0.3)) +
coord_flip()
seq(-0.3, 0.3, 0.5)
seq(-0.3, 0.3, -0.5)
seq(-0.3, 0.3, 0.5)
model_formula <- difference ~ num_tracks + age_selection + zvoc + I(length > 0)
mod_tracking_ext <-
brms::brm(model_formula, family = gaussian(),
data = ready_data_age,
warmup = 1000, iter = 2000, chains = 5
)
lm(model_formula, data = ready_data_age)
pp_check(mod_tracking, type = "dens_overlay", nsamples = 100)
?brms::prior
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("bernoulli(5)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("binomial(5)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("binomial(5, 2)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("binomial(100, 2)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("binomial_log(2)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("beta(1,1)"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ I(age_selection >= 15),
prior = set_prior("bernoulli(beta(1,1))"),
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
install.packages("janitor")
janitor::clean_names(pisa_all[[1]])
janitor::clean_names(pisa_all$value[[1]])
?clean_names
clean_names
janitor::clean_names
ls()
