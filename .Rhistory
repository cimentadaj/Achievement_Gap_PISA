spread(test_bound, bound) %>%
ggplot(aes(as.character(wave), score, group = escs_dummy, colour = escs_dummy)) +
geom_errorbar(aes(ymin = lower_math, ymax = upper_math), width = 0.2) +
geom_line() +
facet_wrap(~ country)
reduced_data <-
map2(both_tests, years, function(.x, .y) {
.x %>%
mutate(wave = .y) %>%
filter(!is.na(escs_dummy))
}) %>%
bind_rows() %>%
as_tibble() %>%
mutate(lower_math = mean_math - 1.96 * se_math,
upper_math = mean_math + 1.96 * se_math,
lower_read = mean_read - 1.96 * se_read,
upper_read = mean_read + 1.96 * se_read)
reduced_data %>%
select(country, wave, escs_dummy, contains("mean")) %>%
gather(test, score, contains("mean"))
reduced_data
reduced_data %>%
select(country, wave, escs_dummy, contains("lower", "upper"))
reduced_data %>%
select(country, wave, escs_dummy, contains("lower"), contains("upper"))
reduced_data %>%
select(country, wave, escs_dummy, contains("lower"), contains("upper")) %>%
gather(test_bound, bound, contains("lower"), contains("upper"))
test_data <-
reduced_data %>%
select(country, wave, escs_dummy, contains("mean")) %>%
gather(test, score, contains("mean"))
reduced_data %>%
select(country, wave, escs_dummy, contains("lower"), contains("upper")) %>%
gather(test_bound, bound, contains("lower"), contains("upper")) %>%
left_join(test_data, by = c("country", "wave", "escs_dummy")
## ----graphin differences, include = T, out.height = '5in', out.width = '5.5in', fig.align = 'center'----
reduced_data %>%
filter(country %in% c("United Kingdom"), test == "mean_math") %>%
spread(test_bound, bound) %>%
ggplot(aes(as.character(wave), score, group = escs_dummy, colour = escs_dummy)) +
geom_errorbar(aes(ymin = lower_math, ymax = upper_math), width = 0.2) +
geom_line() +
facet_wrap(~ country)
## ------------------------------------------------------------------------
# Calculate the joint standard error of the different
se_data <-
reduced_data %>%
select(country, escs_dummy, wave, se_math) %>%
spread(escs_dummy, se_math) %>%
transmute(country, wave,
se_diff = sqrt(abs(`1`^2 - `0`^2)))
## ----include = T, out.height = '5in', out.width = '5.5in', fig.align = 'center'----
# Calculate the different between the gap and together with it's joint s.e graph
# the absolut difference.
countries <- c("Chile", "Austria", "Belgium", "Canada", "Czech Republic", "Denmark",
"Finland", "France", "Germany", "Italy", "Japan", "Netherlands", "Norway",
"Poland", "Spain", "Sweden", "United Kingdom", "United States")
reduced_data %>%
select(country, escs_dummy, Mean, wave) %>%
spread(key = escs_dummy, value = Mean) %>%
mutate(diff = `1` - `0`) %>%
gather(escs_dummy, Mean, -country, -wave, -`1`, -`0`) %>%
left_join(se_data) %>%
mutate(continent = countrycode(country, "country.name", "continent"),
region = countrycode(country, "country.name", "region"),
lower = Mean - 1.96 * se_diff,
upper = Mean + 1.96 * se_diff) %>%
filter(!is.na(continent), !is.na(region), country %in% vals) %>%
ggplot(aes(as.factor(wave), Mean, group = country, colour = country)) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.1) +
geom_line() +
geom_point(size = 0.5) +
scale_colour_discrete(guide = F) +
# geom_smooth(aes(group = region), colour = "blue", method = "lm") +
coord_cartesian(ylim = c(0, 4)) +
facet_wrap(~ country) +
ggtitle("math")
reduced_data %>%
select(country, wave, escs_dummy, contains("lower"), contains("upper")) %>%
gather(test_bound, bound, contains("lower"), contains("upper")) %>%
left_join(test_data, by = c("country", "wave", "escs_dummy"))
all_data <-
reduced_data %>%
select(country, wave, escs_dummy, contains("lower"), contains("upper")) %>%
gather(test_bound, bound, contains("lower"), contains("upper")) %>%
left_join(test_data, by = c("country", "wave", "escs_dummy"))
reduced_data
test_data <-
reduced_data %>%
select(country, wave, escs_dummy, contains("mean")) %>%
gather(test, score, contains("mean"))
test_data
test_data %>%
filter(test == "mean_math")
reduced_data %>%
select(country, wave, escs_dummy, contains("math"))
reduced_data %>%
select(country, wave, escs_dummy, contains("math")) %>%
gather(test_bound, bound, contains("lower"), contains("upper"))
reduced_data %>%
select(country, wave, escs_dummy, contains("math"))
reduced_data %>%
select(country, wave, escs_dummy, contains("math")) %>%
gather(test_bound, bound, contains("lower"), contains("upper"))
reduced_data %>%
select(country, wave, escs_dummy, contains("math")) %>%
gather(test_bound, bound, contains("lower"), contains("upper")) %>%
right_join(test_data)
math_data <- reduced_data %>%
select(country, wave, escs_dummy, contains("math")) %>%
gather(test_bound, bound, contains("lower"), contains("upper")) %>%
right_join(test_data)
test_data
test_data
math_data <-
reduced_data %>%
select(country, wave, escs_dummy, contains("math")) %>%
gather(test_bound, bound, contains("lower"), contains("upper")) %>%
right_join(filter(test_data, test == "mean_math"))
math_data
read_data <-
reduced_data %>%
select(country, wave, escs_dummy, contains("read")) %>%
gather(test_bound, bound, contains("lower"), contains("upper")) %>%
right_join(filter(test_data, test == "mean_read"))
read_data
rbind(math_data, read_data)
rbind_all(math_data, read_data)
math_data
read_data
bind_rows(math_data, read_data)
test_data
bind_rows(math_data, read_data)
read_data
math_data
read_data
?bind_rows()
bind_rows
read_data
bind_rows(math_data, read_data)
math_data <-
reduced_data %>%
select(country, wave, escs_dummy, contains("math")) %>%
gather(test_bound, bound, contains("lower"), contains("upper")) %>%
right_join(filter(test_data, test == "mean_math"))
math_data
math_data <-
reduced_data %>%
select(country, wave, escs_dummy, contains("math")) %>%
gather(test_bound, bound, contains("lower"), contains("upper")) %>%
select(-contains("math")) %>%
right_join(filter(test_data, test == "mean_math"))
math_data
read_data <-
reduced_data %>%
select(country, wave, escs_dummy, contains("read")) %>%
gather(test_bound, bound, contains("lower"), contains("upper")) %>%
select(-contains("read")) %>%
right_join(filter(test_data, test == "mean_read"))
bind_rows(math_data, read_data)
all_data <- bind_rows(math_data, read_data)
math_data
math_data %>%
spread(test_bound, bound)
math_data %>%
spread(test_bound, bound) %>%
filter(country %in% c("United Kingdom")) %>%
ggplot(aes(as.character(wave), score, group = escs_dummy, colour = escs_dummy)) +
geom_errorbar(aes(ymin = lower_math, ymax = upper_math), width = 0.2) +
geom_line() +
facet_wrap(~ country)
all_data %>%
select(country, escs_dummy, wave, se_math) %>%
spread(escs_dummy, se_math)
all_data
reduced_data
read_data %>%
spread(test_bound, bound) %>%
filter(country %in% c("United Kingdom")) %>%
ggplot(aes(as.character(wave), score, group = escs_dummy, colour = escs_dummy)) +
geom_errorbar(aes(ymin = lower_read, ymax = upper_read), width = 0.2) +
geom_line() +
facet_wrap(~ country)
all_data
reduced_data
reduced_data %>%
select(country, escs_dummy, wave, se_math, se_read)
?spread
reduced_data %>%
select(country, escs_dummy, wave, se_math) %>%
spread(escs_dummy, se_math) %>%
transmute(country, wave,
se_diff = sqrt(abs(`1`^2 - `0`^2)))
math_se_data <-
reduced_data %>%
select(country, escs_dummy, wave, se_math) %>%
spread(escs_dummy, se_math) %>%
transmute(country, wave,
se_diff_math = sqrt(abs(`1`^2 - `0`^2)))
read_se_data <-
reduced_data %>%
select(country, escs_dummy, wave, se_read) %>%
spread(escs_dummy, se_read) %>%
transmute(country, wave,
se_diff_read = sqrt(abs(`1`^2 - `0`^2)))
read_se_data
se_data <- left_join(math_se_data, read_se_data)
se_data
se_data
reduced_data
reduced_data
reduced_data %>%
select(country, escs_dummy, Mean, wave)
reduced_data
reduced_data
reduced_data %>%
select(country, escs_dummy, mean_math) %>%
spread(escs_dummy, mean_math)
reduced_data %>%
select(country, escs_dummy, mean_math)
reduced_data %>%
select(wave, country, escs_dummy, mean_math) %>%
spread(escs_dummy, mean_math)
reduced_data %>%
select(wave, country, escs_dummy, mean_math) %>%
spread(escs_dummy, mean_math) %>%
mutate(diff_math = `1` - `0`)
math_diff <-
reduced_data %>%
select(wave, country, escs_dummy, mean_math) %>%
spread(escs_dummy, mean_math) %>%
transmute(country, escs_dummy, diff_math = `1` - `0`)
reduced_data %>%
select(wave, country, escs_dummy, mean_math) %>%
spread(escs_dummy, mean_math)
math_diff <-
reduced_data %>%
select(wave, country, escs_dummy, mean_math) %>%
spread(escs_dummy, mean_math) %>%
transmute(wave, country, diff_math = `1` - `0`)
math_diff
read_diff <-
reduced_data %>%
select(wave, country, escs_dummy, mean_read) %>%
spread(escs_dummy, mean_read) %>%
transmute(wave, country, diff_read = `1` - `0`)
read_diff
math_diff
math_diff %>%
left_join(read_diff)
se_data
math_diff %>%
left_join(read_diff) %>%
left_join(se_data)
se_data
math_diff %>%
left_join(read_diff) %>%
left_join(se_data)
math_diff %>%
left_join(read_diff) %>%
left_join(se_data)
math_diff %>%
left_join(read_diff) %>%
left_join(se_data) %>%
gather(test, diff, starts_with("diff"))
math_diff %>%
left_join(read_diff) %>%
gather(test, diff, starts_with("diff"))
se_data
math_diff %>%
left_join(read_diff) %>%
left_join(se_data)
math_diff %>%
left_join(read_diff) %>%
left_join(se_data)
math_diff %>%
left_join(read_diff) %>%
left_join(se_data)
math_diff %>%
left_join(read_diff) %>%
left_join(se_data) %>%
tranmute(wave, country, diff_math, diff_read,
lower_math = diff_math - 1.96 * se_diff_math,
lower_read = diff_read - 1.96 * se_diff_read,
upper_math = diff_math + 1.96 * se_diff_math,
upper_read = diff_read + 1.96 * se_diff_read)
math_diff %>%
left_join(read_diff) %>%
left_join(se_data) %>%
transmute(wave, country, diff_math, diff_read,
lower_math = diff_math - 1.96 * se_diff_math,
lower_read = diff_read - 1.96 * se_diff_read,
upper_math = diff_math + 1.96 * se_diff_math,
upper_read = diff_read + 1.96 * se_diff_read)
data_summaries <-
math_diff %>%
left_join(read_diff) %>%
left_join(se_data) %>%
transmute(wave, country, diff_math, diff_read,
lower_math = diff_math - 1.96 * se_diff_math,
lower_read = diff_read - 1.96 * se_diff_read,
upper_math = diff_math + 1.96 * se_diff_math,
upper_read = diff_read + 1.96 * se_diff_read)
data_summaries
data_summaries %>%
gather(test, difference, starts_with("diff"))
data_summaries %>%
gather(test, difference, starts_with("diff")) %>%
gather(type_bound, bound, contains("math"), contains("read"))
data_summaries %>%
gather(test, difference, starts_with("diff")) %>%
gather(type_bound, bound, contains("math"), contains("read")) %>%
arrange(wave, country, test, type_bound)
data_summaries %>%
gather(test, difference, starts_with("diff")) %>%
gather(type_bound, bound, contains("math"))
data_summaries <-
math_diff %>%
left_join(read_diff) %>%
left_join(se_data) %>%
transmute(wave, country, diff_math, diff_read,
lower_math = diff_math - 1.96 * se_diff_math,
lower_read = diff_read - 1.96 * se_diff_read,
upper_math = diff_math + 1.96 * se_diff_math,
upper_read = diff_read + 1.96 * se_diff_read)
data_summaries
data_summaries %>%
select(wave, country, diff_math, diff_read)
data_summaries %>%
select(wave, country, diff_math, diff_read) %>%
gather(test, difference, starts_with("diff"))
data_summaries
data_summaries %>%
select(wave, country, contains("lower"), contains("upper")) %>%
gather(test, difference, starts_with("diff"))
data_summaries %>%
select(wave, country, contains("lower"), contains("upper")) %>%
gather(type_bound, bound, lower_math:upper_read)
data_summaries %>%
select(wave, country, diff_math, diff_read) %>%
gather(test, difference, starts_with("diff"))
data_summaries %>%
select(wave, country, diff_math, diff_read) %>%
gather(test, difference, starts_with("diff")) %>%
mutate(test = ifelse(.$diff_read == "diff_math", "math", "read"))
data_summaries %>%
select(wave, country, diff_math, diff_read) %>%
gather(test, difference, starts_with("diff")) %>%
mutate(type_test = ifelse(.$test == "diff_math", "math", "read"))
data_summaries %>%
select(wave, country, contains("lower"), contains("upper")) %>%
gather(type_bound, bound, lower_math:upper_read)
data_summaries %>%
select(wave, country, contains("lower"), contains("upper")) %>%
gather(type_bound, bound, lower_math:upper_read) %>%
mutate(type_test = ifelse(grepl("math", .$test), "math", "read"))
grepl("math", "lower_math")
grepl("math", "lower_read")
grepl("math", "upper_math")
data_summaries %>%
select(wave, country, contains("lower"), contains("upper")) %>%
gather(type_bound, bound, lower_math:upper_read) %>%
mutate(type_test = ifelse(grepl("math", .$test), "math", "read"))
data_summaries %>%
select(wave, country, contains("lower"), contains("upper")) %>%
gather(type_bound, bound, lower_math:upper_read) %>%
mutate(type_test = ifelse(grepl("math", .$test_bound), "math", "read"))
data_summaries %>%
select(wave, country, contains("lower"), contains("upper")) %>%
gather(type_bound, bound, lower_math:upper_read)
data_summaries %>%
select(wave, country, contains("lower"), contains("upper")) %>%
gather(type_bound, bound, lower_math:upper_read) %>%
mutate(type_test = ifelse(grepl("math", .$type_bound), "math", "read"))
differences <-
data_summaries %>%
select(wave, country, diff_math, diff_read) %>%
gather(test, difference, starts_with("diff")) %>%
mutate(type_test = ifelse(.$test == "diff_math", "math", "read"))
differences
bounds
bounds <-
data_summaries %>%
select(wave, country, contains("lower"), contains("upper")) %>%
gather(type_bound, bound, lower_math:upper_read) %>%
mutate(type_test = ifelse(grepl("math", .$type_bound), "math", "read"))
bounds
left_join(differences, bounds)
left_join(differences, bounds) %>%
arrange(wave, country, test, type_bound)
complete_data <- left_join(differences, bounds)
complete_data %>%
mutate(continent = countrycode(country, "country.name", "continent"),
region = countrycode(country, "country.name", "region")) %>%
filter(!is.na(continent), !is.na(region), country %in% countries_subset)
countries_subset <- c("Australia",
"Germany",
"Denmark",
"Spain",
"France",
"Italy",
"Netherlands",
"Sweden",
"United States")
complete_data %>%
mutate(continent = countrycode(country, "country.name", "continent"),
region = countrycode(country, "country.name", "region")) %>%
filter(!is.na(continent), !is.na(region), country %in% countries_subset)
complete_data %>%
mutate(continent = countrycode(country, "country.name", "continent"),
region = countrycode(country, "country.name", "region")) %>%
filter(!is.na(continent), !is.na(region), country %in% countries_subset)
data_summaries %>%
select(wave, country, contains("lower"), contains("upper"))
data_summaries %>%
select(wave, country, contains("lower")) %>%
gather(type_bound, bound, lower_math, lower_read)
data_summaries %>%
select(wave, country, contains("lower")) %>%
gather(lower_bound, lower, lower_math, lower_read
data_summaries %>%
select(wave, country, contains("lower")) %>%
gather(lower_bound, lower, lower_math, lower_read)
bounds_lower <-
data_summaries %>%
select(wave, country, contains("lower")) %>%
gather(lower_bound, lower, lower_math, lower_read) %>%
mutate(type_test = ifelse(grepl("math", .$type_bound), "math", "read"))
bounds_lower <-
data_summaries %>%
select(wave, country, contains("lower")) %>%
gather(lower_bound, lower, lower_math, lower_read) %>%
mutate(type_test = ifelse(grepl("math", .$lower_bound), "math", "read"))
bounds_lower
bounds_upper <-
data_summaries %>%
select(wave, country, contains("upper")) %>%
gather(upper_bound, upper, upper_math, upper_read) %>%
mutate(type_test = ifelse(grepl("math", .$upper_bound), "math", "read"))
complete_data <-
left_join(differences, bounds_lower) %>%
left_join(bounds_upper)
complete_data
complete_data %>% arrange(wave, country, test, lower_bound, upper_bound)
complete_data %>%
mutate(continent = countrycode(country, "country.name", "continent"),
region = countrycode(country, "country.name", "region")) %>%
filter(!is.na(continent), !is.na(region), country %in% countries_subset)
complete_data %>%
mutate(continent = countrycode(country, "country.name", "continent"),
region = countrycode(country, "country.name", "region")) %>%
filter(!is.na(continent), !is.na(region), country %in% countries_subset) %>%
ggplot(aes(as.factor(wave), difference, group = test, colour = test)) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.1) +
geom_line() +
geom_point(size = 0.5) +
scale_colour_discrete(guide = F) +
# geom_smooth(aes(group = region), colour = "blue", method = "lm") +
coord_cartesian(ylim = c(0, 4)) +
facet_wrap(~ country)
complete_data %>%
mutate(continent = countrycode(country, "country.name", "continent"),
region = countrycode(country, "country.name", "region")) %>%
filter(!is.na(continent), !is.na(region), country %in% countries_subset) %>%
ggplot(aes(as.factor(wave), difference, group = test, colour = test)) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.1) +
geom_line() +
geom_point(size = 0.5) +
# geom_smooth(aes(group = region), colour = "blue", method = "lm") +
coord_cartesian(ylim = c(0, 4)) +
facet_wrap(~ country)
complete_data %>%
mutate(continent = countrycode(country, "country.name", "continent"),
region = countrycode(country, "country.name", "region")) %>%
filter(!is.na(continent), !is.na(region)) %>%
ggplot(aes(as.factor(wave), difference, group = test, colour = test)) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.1) +
geom_line() +
geom_point(size = 0.5) +
coord_cartesian(ylim = c(0, 4)) +
facet_wrap(~ country)
countries_subset <- c("Australia",
"Germany",
"Denmark",
"Spain",
"France",
"Italy",
"Netherlands",
"Sweden",
"United States",
"United Kingdom")
countries_subset <- c("Australia",
"Germany",
"Denmark",
"Spain",
"France",
"Italy",
"Netherlands",
"Sweden",
"United States",
"United Kingdom")
complete_data %>%
mutate(continent = countrycode(country, "country.name", "continent"),
region = countrycode(country, "country.name", "region")) %>%
filter(!is.na(continent), !is.na(region), country %in% countries_subset) %>%
ggplot(aes(as.factor(wave), difference, group = test, colour = test)) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.1) +
geom_line() +
geom_point(size = 0.5) +
coord_cartesian(ylim = c(0, 4)) +
facet_wrap(~ country)
