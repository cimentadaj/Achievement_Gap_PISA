scale_fill_manual(values = c("orangered2", "blue3"), guide = F) +
ggtitle("Predicted 90/10 gap for different combinations of number of tracks and age of selection")
new_data %>%
left_join(sum_ready_data) %>%
mutate(age_selection = ifelse(age_selection == 1, ">= 15", "< 15"))
new_data %>%
left_join(sum_ready_data) %>%
mutate(age_selection = ifelse(age_selection == 1, ">= 15", "< 15"))
new_data %>%
left_join(sum_ready_data) %>%
mutate(age_selection = ifelse(age_selection == 1, ">= 15", "< 15"))
new_data %>%
left_join(sum_ready_data)
new_data %>%
left_join(sum_ready_data) %>%
filter(num_tracks == 1 & age_selection == 1, !is.na(avg_diff))
new_data %>%
left_join(sum_ready_data) %>%
filter(!is.na(avg_diff))
new_data %>%
left_join(sum_ready_data) %>%
filter(!is.na(avg_diff))
new_data %>%
left_join(sum_ready_data) %>%
filter(!is.na(avg_diff)) %>%
select(country, num_tracks, age_selection, pred, avg_diff)
new_data %>%
left_join(sum_ready_data) %>%
filter(!is.na(avg_diff), num_tracks == 1 & age_selection == 1) %>%
select(country, num_tracks, age_selection, pred, avg_diff)
new_data %>%
left_join(sum_ready_data) %>%
filter(!is.na(avg_diff) | num_tracks == 1 & age_selection == 1) %>%
select(country, num_tracks, age_selection, pred, avg_diff)
m <-
new_data %>%
left_join(sum_ready_data) %>%
filter(!is.na(avg_diff) | num_tracks == 1 & age_selection == 1) %>%
select(country, num_tracks, age_selection, pred, avg_diff)
m$country %>% duplicated()
m$country %>% duplicated %>% m$country[]
m$country[m$country %>% duplicated]
track_should_change <- m$country[m$country %>% duplicated]
m %>% filter(country %in% track_should_change)
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff)) %>%
select(-pred)
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = unite(num_tracks, age_selection))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = unite(num_tracks %>% as.character,
age_selection %>% as.character))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = unite(num_tracks %>% as.double,
age_selection %>% as.double))
?unite
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = unite(combn, num_tracks %>% as.double,
age_selection %>% as.double))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = unite(comb, num_tracks %>% as.double,
age_selection %>% as.double))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = unite("comb",
num_tracks %>% as.double,
age_selection %>% as.double))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = unite("comb",
num_tracks,
age_selection))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
num_tracks = as.character(num_tracks),
age_selection = as.character(age_selection),
combn = unite("comb",
num_tracks,
age_selection))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
# num_tracks = as.character(num_tracks),
# age_selection = as.character(age_selection),
combn = unite(comb,
c("num_tracks","age_selection")))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
# num_tracks = as.character(num_tracks),
# age_selection = as.character(age_selection),
combn = unite(comb, num_tracks, age_selection))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
# num_tracks = as.character(num_tracks),
# age_selection = as.character(age_selection),
combn = unite(., new_var, num_tracks, age_selection))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
# num_tracks = as.character(num_tracks),
# age_selection = as.character(age_selection),
combn = paste0(new_var, num_tracks, age_selection, sep = "_"))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
# num_tracks = as.character(num_tracks),
# age_selection = as.character(age_selection),
combn = paste0(num_tracks, age_selection, sep = "_"))
m %>%
filter(country %in% track_should_change) %>%
mutate(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection))
m %>%
filter(country %in% track_should_change) %>%
transmute(avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection))
m %>%
filter(country %in% track_should_change)
m %>%
filter(country %in% track_should_change) %>%
transmute(country,
avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection))
m %>%
filter(country %in% track_should_change) %>%
transmute(country,
avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection)) %>%
spread(combn, avg_diff)
m <-
new_data %>%
left_join(sum_ready_data) %>%
filter(!is.na(avg_diff) | num_tracks == 1 & age_selection == 1) %>%
select(country, num_tracks, age_selection, pred, avg_diff)
track_should_change <- m$country[m$country %>% duplicated]
m %>%
filter(country %in% track_should_change) %>%
transmute(country,
avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection)) %>%
spread(combn, avg_diff)
m %>%
filter(country %in% track_should_change) %>%
transmute(country,
avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection))
m %>%
filter(country %in% track_should_change) %>%
transmute(country,
avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection)) %>%
spread(combn, avg_diff)
m %>%
filter(country %in% track_should_change) %>%
transmute(country,
avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection))
p <-
m %>%
filter(country %in% track_should_change) %>%
transmute(country,
avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection))
m %>%
filter(country %in% track_should_change) %>%
transmute(country,
avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection))
m %>%
filter(country %in% track_should_change) %>%
transmute(country,
avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection)) %>%
filter(combn != "1_1")
p <-
m %>%
filter(country %in% track_should_change) %>%
transmute(country,
avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection)) %>%
filter(combn != "1_1")
p
p %>%
left_join(m %>% filter(country %in% track_should_change), by = "country")
m
m %>%
filter(country %in% track_should_change)
p %>%
left_join(m %>% filter(country %in% track_should_change) %>5 select(country, pred), by = "country")
p %>%
left_join(m %>% filter(country %in% track_should_change) %>% select(country, pred), by = "country")
p
m %>% filter(country %in% track_should_change) %>% select(country, pred)
m
logical_filter <- country %in% track_should_change & (num_tracks == 1 & age_selection == 1)
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country")
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combin, avg_diff, pred)
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred)
?separate
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country")
m
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, combn, c("num_tracks", "age_selection"))
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, combn, c("num_tracks", "age_selection"), sep = "_")
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred)
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_")
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff,
`Predicted inequality` = pred
)
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff %>% round(2),
`Predicted inequality` = pred %>% round(2)
)
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff,
`Predicted inequality` = pred
)
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff %>% round(3),
`Predicted inequality` = pred %>% round(3)
)
(1.58 - 1.27) / `Actual inequality`
(1.58 - 1.27) / 1.58
(1.58 - 1.27) / 1.58 * 100
(1.58 - 1.27) / 1.58 * 100 %>% round(0)
(1.58 - 1.27) / 1.58 * 100 %>% ceiling
?ceiling
(1.58 - 1.27) / (1.58 * 100) %>% ceiling
(1.58 - 1.27) / (1.58 * 100) %>% floor
(1.58 - 1.27) / (1.58 * 100)
((1.58 - 1.27) / 1.58) * 100
((1.58 - 1.27) / 1.58) * 100 %>% ceiling
?ceiling
((1.58 - 1.27) / 1.58) * 100 %>% trunc
((1.58 - 1.27) / 1.58) * 100 %>% round(2)
((1.58 - 1.27) / 1.58) * 100 %>% round(3)
((1.58 - 1.27) / 1.58) * 100
(((1.58 - 1.27) / 1.58) * 100) %>% round(2)
(((1.58 - 1.27) / 1.58) * 100) %>% ceiling(2)
(((1.58 - 1.27) / 1.58) * 100) %>% ceiling()
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff %>% round(3),
`Predicted inequality` = pred %>% round(3),
`% reduction` = (`Actual inequality` - `Predicted inequality`/ `Actual inequality`) * 100 %>%
ceiling()
)
((1.58 - 1.27) / 1.58) * 100
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff %>% round(3),
`Predicted inequality` = pred %>% round(3),
`% reduction` = ((`Actual inequality` - `Predicted inequality`)/ `Actual inequality`) * 100
)
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff %>% round(3),
`Predicted inequality` = pred %>% round(3),
`% reduction` = ((`Actual inequality` - `Predicted inequality`)/ `Actual inequality`) * 100 %>%
ceiling
)
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff %>% round(3),
`Predicted inequality` = pred %>% round(3),
`% reduction` = (((`Actual inequality` - `Predicted inequality`)/ `Actual inequality`) * 100) %>%
ceiling
)
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff %>% round(3),
`Predicted inequality` = pred %>% round(3),
`% reduction` = ((`Actual inequality` - `Predicted inequality`)/ `Actual inequality`) %>%
ceiling() * 100
)
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff %>% round(3),
`Predicted inequality` = pred %>% round(3),
`% reduction` = ((`Actual inequality` - `Predicted inequality`)/ `Actual inequality`) %>%
ceiling()
)
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff %>% round(3),
`Predicted inequality` = pred %>% round(3),
`% reduction` = (((`Actual inequality` - `Predicted inequality`)/ `Actual inequality`) * 100) %>%
ceiling
)
p %>%
left_join(m %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff %>% round(3),
`Predicted inequality` = pred %>% round(3),
`% reduction` = (((`Actual inequality` - `Predicted inequality`)/ `Actual inequality`) * 100) %>%
ceiling %>% paste0("%")
)
new_data %>%
left_join(sum_ready_data) %>%
filter(!is.na(avg_diff) | num_tracks == 1 & age_selection == 1) %>%
select(country, num_tracks, age_selection, pred, avg_diff)
pred_avg_diff<-
new_data %>%
left_join(sum_ready_data) %>%
filter(!is.na(avg_diff) | num_tracks == 1 & age_selection == 1) %>%
select(country, num_tracks, age_selection, pred, avg_diff)
track_should_change <- pred_avg_diff$country[pred_avg_diff$country %>% duplicated]
pred_avg_diff %>%
filter(country %in% track_should_change) %>%
transmute(country,
avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection)) %>%
filter(combn != "1_1")
rm(m)
avg_diff_data <-
pred_avg_diff %>%
filter(country %in% track_should_change) %>%
transmute(country,
avg_diff = ifelse(avg_diff %>% is.na, pred, avg_diff),
combn = paste0(num_tracks, "_", age_selection)) %>%
filter(combn != "1_1")
avg_diff_data %>%
left_join(pred_avg_diff %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff %>% round(3),
`Predicted inequality` = pred %>% round(3),
`% reduction` = (((`Actual inequality` - `Predicted inequality`)/ `Actual inequality`) * 100) %>%
ceiling %>% paste0("%")
)
final_avg_diff_table <-
avg_diff_data %>%
left_join(pred_avg_diff %>%
filter(country %in% track_should_change & (num_tracks == 1 & age_selection == 1)) %>%
select(country, pred), by = "country") %>%
select(country, combn, avg_diff, pred) %>%
separate(combn, c("num_tracks", "age_selection"), sep = "_") %>%
transmute(
Country = country,
`Number of tracks` = ifelse(num_tracks == 0, "More than one track", "One track"),
`Age of selection` = ifelse(age_selection == 1, "15 or more", "Less than 15"),
`Actual inequality` = avg_diff %>% round(3),
`Predicted inequality` = pred %>% round(3),
`% reduction` = (((`Actual inequality` - `Predicted inequality`)/ `Actual inequality`) * 100) %>%
ceiling %>% paste0("%")
)
xtable(final_avg_diff_table) %>% print.xtable(
include.rownames = FALSE,
)
