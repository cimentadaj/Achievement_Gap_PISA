mod_tracking
nobs(mod_tracking)
bayes_R2(mod_tracking)
mod_tracking <-
brms::brm(
log(difference) ~
log(ztrack) +
log(zvoc) +
log(ztrack):log(zvoc), family = gaussian(),
data = ready_data_age,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
exp(0.11)
1.10 ^ - 0.70
1 - (1.10 ^ - 0.70)
bayes_R2(mod_tracking)
mod_tracking <-
brms::brm(
log(difference) ~
ztrack +
zvoc +
ztrack:zvoc, family = gaussian(),
data = ready_data_age,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
bayes_R2(mod_tracking)
bayes_R2(mod_tracking)
new_data <-
ready_data_age %>%
filter(country %in% countries) %>%
expand(country, age_selection, num_tracks) %>%
filter(complete.cases(.))
marginal_effects(mod_tracking)
predictions <- posterior_predict(mod_tracking, newdata = new_data)
ready_data_age %>%
filter(country %in% countries)
ready_data_age %>%
filter(country %in% countries) %>%
expand(country, age_selection, num_tracks)
?expand
ready_data_age %>%
filter(country %in% countries)
ready_data_age %>%
filter(country %in% countries)
ready_data_age %>%
filter(country %in% countries)
?expand
crossing(mtcars$cyl, mtcars$wt)
crossing(mtcars$cyl, mtcars$am)
crossing
cross_df
crossing(filter(ready_data_age %>% country %in% countries))
crossing(filter(ready_data_age, country %in% countries))
pp_check(mod_tracking, type = "dens_overlay", nsamples = 1000)
pp_check(mod_tracking, type = "dens_overlay", nsamples = 100)
pp_check(mod_tracking, type = "", nsamples = 100)
pp_check(mod_tracking, type = "scatter_avg_grouped", nsamples = 100)
pp_check(mod_tracking, type = "scatter_avg", nsamples = 100)
mod_tracking <-
brms::brm(
difference ~
ztrack +
zvoc +
ztrack:zvoc, family = gaussian(),
data = ready_data_age,
warmup = 1000, iter = 2000, chains = 5
)
bayes_R2(mod_tracking)
mod_tracking
pp_check(mod_tracking, type = "dens_overlay", nsamples = 100)
pp_check(mod_tracking, type = "scatter_avg", nsamples = 100)
pp_check(mod_tracking, type = "")
pp_check(mod_tracking, type = "boxplot")
pp_check(mod_tracking, type = "boxplot", nsamples = 50)
pp_check(mod_tracking, type = "boxplot", nsamples = 20)
pp_check(mod_tracking, type = "error_hist", nsamples = 20)
pp_check(mod_tracking, type = "error_hist", nsamples = 6)
pp_check(mod_tracking, type = "intervals", nsamples = 6)
pp_check(mod_tracking, type = "intervals")
pp_check(mod_tracking, type = "")
pp_check(mod_tracking, type = "ecdf_overlay")
pp_check(mod_tracking, type = "scatter_avg_vs_x", x = "ztrack")
pp_check(mod_tracking, type = "error_scatter_avg_vs_x", x = "ztrack")
?pp_check
pp_check(mod_tracking, type = "error_scatter_avg_vs_x", x = "zvoc")
library(readxl)
tracking_data <-
read_xlsx("./paper/data/tracking.xlsx", sheet = "all_data") %>%
map_if(is_double, round, 2) %>%
as_tibble
difference_data <-
complete_gaps %>%
filter(type_test == "math", type == "90th/10th SES gap") %>%
select(wave, country, difference) %>%
rename(year = wave) %>%
mutate(year = as.character(year))
library(inequalityintsvy)
central_examination <-
tribble(
~ country, ~central_examination,
"Australia", 1,
"Austria", 0,
"Belgium", 0,
"Bulgaria", 1,
"Canada", rbinom(1, 1, prob = 0.51),
"Czech Republic", 1,
"Denmark", 1,
"Finland", 1,
"France", 1,
"Germany", 0,
"United Kingdom", 1,
"Greece", 0,
"Hong Kong", 1,
"Hungary", 1,
"Iceland", 1,
"Ireland", 1,
"Israel", 1,
"Italy", 1,
"Japan", 1,
"Korea", 1,
"Latvia", 1,
"Liechtenstein", 1,
"Luxembourg", 1,
"Netherlands", 1,
"New Zealand", 1,
"Norway", 1,
"Poland", 1,
"Portugal", 0,
"Russia", 1,
"Slovakia", 1,
"Slovenia", 1,
"Spain", 0,
"Sweden", 0,
"Switzerland", 0,
"Turkey", 1,
"United States", 1
)
ready_data <-
difference_data %>%
left_join(tracking_data, by = c("country" = "cntry_name")) %>%
left_join(central_examination) %>%
left_join(school_data_ready) %>%
mutate(num_tracks = ifelse(tracks15y == 1, 1, 0) %>% as.factor,
age_selection = selage) %>%
filter(!is.na(num_tracks), !is.na(age_selection), !is.na(difference))
ready_data_age <- mutate(ready_data, age_selection = ifelse(selage >= 15, 1, 0) %>% as.factor)
library(brms)
mod_tracking <-
brms::brm(
difference ~
ztrack +
zvoc +
ztrack:zvoc, family = gaussian(),
data = ready_data_age,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
bayes_R2(mod_tracking)
pp_check(mod_tracking, type = "dens_overlay", nsamples = 100)
pp_check(mod_tracking, type = "scatter_avg", nsamples = 100)
pp_check(mod_tracking, type = "boxplot", nsamples = 20)
pp_check(mod_tracking, type = "error_hist", nsamples = 6)
pp_check(mod_tracking, type = "ecdf_overlay")
pp_check(mod_tracking, type = "error_scatter_avg_vs_x", x = "zvoc")
pp_check(mod_tracking, type = "error_scatter_avg_vs_x", x = "ztrack")
mod_tracking <-
brms::brm(
ztrack +
zvoc +
ztrack:zvoc +
(1 | country),
family = gaussian(),
data = ready_data_age,
prior = c(set_prior("normal(0, 1)", coef = "ztrack"),
set_prior("normal(0, 1)", coef = "zvoc")),
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
brms::brm(
difference ~
ztrack +
zvoc +
ztrack:zvoc +
(1 | country),
family = gaussian(),
data = ready_data_age,
prior = c(set_prior("normal(0, 1)", coef = "ztrack"),
set_prior("normal(0, 1)", coef = "zvoc")),
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
mod_tracking <-
brms::brm(
(1 | country),
family = gaussian(),
data = ready_data_age,
prior = c(set_prior("normal(0, 1)", coef = "ztrack"),
set_prior("normal(0, 1)", coef = "zvoc")),
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
brms::brm(
difference ~
(1 | country),
family = gaussian(),
data = ready_data_age,
prior = c(set_prior("normal(0, 1)", coef = "ztrack"),
set_prior("normal(0, 1)", coef = "zvoc")),
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking <-
brms::brm(
difference ~
(1 | country),
family = gaussian(),
data = ready_data_age,
# prior = c(set_prior("normal(0, 1)", coef = "ztrack"),
#           set_prior("normal(0, 1)", coef = "zvoc")),
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
mod_tracking <-
brms::brm(
difference ~
ztrack +
zvoc +
ztrack:zvoc +
(1 | country),
family = gaussian(),
data = ready_data_age,
prior = c(set_prior("normal(0, 1)", coef = "ztrack"),
set_prior("normal(0, 1)", coef = "zvoc")),
warmup = 1000, iter = 1000, chains = 4
)
k0d
mod_tracking
mod_tracking <-
brms::brm(
difference ~
ztrack +
zvoc +
ztrack:zvoc +
(1 | country),
family = gaussian(),
data = ready_data_age,
prior = c(set_prior("normal(0, 1)", coef = "ztrack"),
set_prior("normal(0, 1)", coef = "zvoc")),
warmup = 1000, iter = 1000, chains = 4
)
mod_tracking
mod_tracking <-
brms::brm(
difference ~
ztrack +
zvoc +
ztrack:zvoc + (1 | country),
family = gaussian(),
data = ready_data_age,
prior = c(set_prior("normal(0, 1)", coef = "ztrack"),
set_prior("normal(0, 1)", coef = "zvoc")),
warmup = 1000, iter = 2000, chains = 4
)
mod_tracking
launch_shiny(mod_tracking)
mod_tracking
vars_unique <- c("length", "num_tracks", "age_selection", "central_examination", "ztrack")
ready_data_two <-
ready_data %>%
group_by(country) %>%
summarize_at(vars(vars_unique), unique) %>%
mutate(cum_diff = ready_data %>% group_by(country) %>% summarize(m = sum(difference)) %>% pull(m))
mod_tracking <-
ready_data_two %>%
lm(cum_diff ~ age_selection, data = .) %>%
arm::display(detail = T)
ready_data_two
ready_data_two %>%
mutate(age_selection = ifelse(age_selection >= 15, 1, 0)) 5>%
lm(cum_diff ~ age_selection, data = .) %>%
arm::display(detail = T)
ready_data_two %>%
mutate(age_selection = ifelse(age_selection >= 15, 1, 0)) %>%
lm(cum_diff ~ age_selection, data = .) %>%
arm::display(detail = T)
mod_tracking <-
ready_data_two %>%
mutate(age_selection = ifelse(age_selection >= 15, 1, 0)) %>%
lm(cum_diff ~ age_selection, data = .) %>%
arm::display(detail = T)
ready_data_two %>%
mutate(age_selection = ifelse(age_selection >= 15, 1, 0)) %>%
lm(cum_diff ~ ztrack, data = .) %>%
arm::display(detail = T)
ready_data_two %>%
mutate(age_selection = ifelse(age_selection >= 15, 1, 0)) %>%
lm(cum_diff ~ ztrack + zvoc, data = .) %>%
arm::display(detail = T)
ready_data_two
vars_unique <- c("length", "num_tracks", "age_selection", "central_examination", "ztrack",
"zvoc")
ready_data_two <-
ready_data %>%
group_by(country) %>%
summarize_at(vars(vars_unique), unique) %>%
mutate(cum_diff = ready_data %>% group_by(country) %>% summarize(m = sum(difference)) %>% pull(m))
mod_tracking <-
ready_data_two %>%
lm(cum_diff ~ ztrack + zvoc, data = .) %>%
arm::display(detail = T)
mod_tracking
mod_tracking <-
ready_data_two %>%
lm(cum_diff ~ ztrack + zvoc, data = .)
mod_tracking
ready_data_two %>%
lm(cum_diff ~ ztrack + zvoc, data = .) %>%
arm::display(detail = T)
mod_tracking <-
ready_data_two %>%
filter(!is.na(age_selection)) %>%
brm(
cum_diff ~ ztrack + zvoc,
family = gaussian(),
data = .,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
bayes_R2(mod_tracking)
pp_check(mod_tracking, type = "dens_overlay", nsamples = 100)
pp_check(mod_tracking, type = "ecdf_overlay", nsamples = 10)
pp_check(mod_tracking, type = "boxplot", nsamples = 30)
pp_check(mod_tracking, type = "stat", nsamples = 200) # very nice to compare central tendency
pp_check(mod_tracking, type = "error_scatter_avg", nsamples = 1000)
pp_check(mod_tracking, type = "loo_pit")
difference_data <-
complete_gaps %>%
filter(type_test == "math", type == "80th/20th SES gap") %>%
select(wave, country, difference) %>%
rename(year = wave) %>%
mutate(year = as.character(year))
library(inequalityintsvy)
central_examination <-
tribble(
~ country, ~central_examination,
"Australia", 1,
"Austria", 0,
"Belgium", 0,
"Bulgaria", 1,
"Canada", rbinom(1, 1, prob = 0.51),
"Czech Republic", 1,
"Denmark", 1,
"Finland", 1,
"France", 1,
"Germany", 0,
"United Kingdom", 1,
"Greece", 0,
"Hong Kong", 1,
"Hungary", 1,
"Iceland", 1,
"Ireland", 1,
"Israel", 1,
"Italy", 1,
"Japan", 1,
"Korea", 1,
"Latvia", 1,
"Liechtenstein", 1,
"Luxembourg", 1,
"Netherlands", 1,
"New Zealand", 1,
"Norway", 1,
"Poland", 1,
"Portugal", 0,
"Russia", 1,
"Slovakia", 1,
"Slovenia", 1,
"Spain", 0,
"Sweden", 0,
"Switzerland", 0,
"Turkey", 1,
"United States", 1
)
ready_data <-
difference_data %>%
left_join(tracking_data, by = c("country" = "cntry_name")) %>%
left_join(central_examination) %>%
left_join(school_data_ready) %>%
mutate(num_tracks = ifelse(tracks15y == 1, 1, 0) %>% as.factor,
age_selection = selage) %>%
filter(!is.na(num_tracks), !is.na(age_selection), !is.na(difference))
ready_data_age <- mutate(ready_data, age_selection = ifelse(selage >= 15, 1, 0) %>% as.factor)
mod_tracking <-
brms::brm(
difference ~
ztrack +
zvoc +
ztrack:zvoc, family = gaussian(),
data = ready_data_age,
warmup = 1000, iter = 2000, chains = 5
)
mod_tracking
bayes_R2(mod_tracking)
ls()
library(matrixStats)
library(tidyverse)
library(knitr)
library(arm)
library(saves)
library(haven)
library(PISA2000lite)
library(PISA2003lite)
library(PISA2006lite)
library(PISA2009lite)
library(PISA2012lite)
library(intsvy)
library(cimentadaj) # devtools::install_github("cimentadaj/cimentadaj")
library(countrycode) # For region variable
library(car)
library(SAScii)
library(inequalityintsvy) # devtools::install_github("cimentadaj/inequalityintsvy")
library(lme4)
library(modelr)
library(ggrepel)
library(xtable)
library(ggthemes)
# source("./transform_data.R")
# Conf for PISA_2015
pisa2015_conf <- list(variables = list(pvlabelpref = "PV",
pvlabelsuff = "READ",
weightFinal = "W_FSTUWT",
weightBRR = "W_FSTURWT"),
parameters = list(cutoffs = c(357.77, 420.07, 482.38, 544.68, 606.99, 669.30),
percentiles = c(5, 10, 25, 75, 90, 95),
PVreps = 10,
BRRreps = 80,
weights = "BRR",
replication_scheme = 'pisa')
)
countries <- c("Finland",
"France",
# "New Zealand",
"Austria",
"Australia",
"Sweden",
# "Czech Republic",
"Canada",
"Hungary",
# "Iceland",
"Netherlands",
"Spain",
# "Belgium",
"Italy",
# "Norway",
"United Kingdom",
# "Greece",
"Denmark",
# "Israel",
"Poland",
"United States",
"Germany"
# "Turkey",
# "Russia"
)
library(readxl)
tracking_data <-
read_xlsx("./paper/data/tracking.xlsx", sheet = "all_data") %>%
map_if(is_double, round, 2) %>%
as_tibble
difference_data <-
complete_gaps %>%
filter(type_test == "math", type == "90th/10th SES gap") %>%
select(wave, country, difference) %>%
rename(year = wave) %>%
mutate(year = as.character(year))
library(inequalityintsvy)
results_math_80 <- read_rds("./paper/data/math_80.Rdata")
results_read_80 <- read_rds("./paper/data/read_80.Rdata")
results_math_topmid_80 <- read_rds("./paper/data/math_topmid_80.Rdata")
results_read_topmid_80 <- read_rds("./paper/data/read_topmid_80.Rdata")
results_math_midbottom_80 <- read_rds("./paper/data/math_midbottom_80.Rdata")
results_read_midbottom_80 <- read_rds("./paper/data/read_midbottom_80.Rdata")
results_math_70 <- read_rds("./paper/data/math_70.Rdata")
results_read_70 <- read_rds("./paper/data/read_70.Rdata")
results_math_topmid_70 <- read_rds("./paper/data/math_topmid_70.Rdata")
results_read_topmid_70 <- read_rds("./paper/data/read_topmid_70.Rdata")
results_math_midbottom_70 <- read_rds("./paper/data/math_midbottom_70.Rdata")
results_read_midbottom_70 <- read_rds("./paper/data/read_midbottom_70.Rdata")
complete_data_topbottom_80 <-
pisa_preparer(results_math_80, results_read_80) %>%
mutate(type = "80th/20th SES gap")
complete_data_topmid_80 <-
pisa_preparer(results_math_topmid_80, results_read_topmid_80) %>%
mutate(type = "80th/50th SES gap")
complete_data_midbottom_80 <-
pisa_preparer(results_math_midbottom_80, results_read_midbottom_80) %>%
mutate(type = "50th/20th SES gap")
######
complete_data_topbottom_70 <-
pisa_preparer(results_math_70, results_read_70) %>%
mutate(type = "70th/30th SES gap")
complete_data_topmid_70 <-
pisa_preparer(results_math_topmid_70, results_read_topmid_70) %>%
mutate(type = "70th/50th SES gap")
complete_data_midbottom_70 <-
pisa_preparer(results_math_midbottom_70, results_read_midbottom_70) %>%
mutate(type = "50th/30th SES gap")
#####
complete_gaps <-
complete_data_topbottom %>%
bind_rows(complete_data_topbottom_80) %>%
bind_rows(complete_data_topbottom_70)
